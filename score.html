<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @media screen and (orientation: landscape) and (max-height: 600px) {
            .mobile-landscape {
                padding: 1rem !important;
            }
            .mobile-landscape .score-text {
                font-size: 4rem !important;
            }
            .mobile-landscape .header-text {
                font-size: 1.5rem !important;
                margin-bottom: 1rem !important;
            }
            .mobile-landscape .section-spacing {
                margin-bottom: 1rem !important;
            }
        }
    </style>
    <title>Table Tennis Score Counter</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-green-600 to-blue-600 min-h-screen p-4 mobile-landscape">
    <!-- Pre-Match Screen -->
    <div id="preMatch" class="flex items-center justify-center min-h-screen">
        <div class="bg-white rounded-3xl shadow-2xl p-12 text-center max-w-md w-full">
            <div class="text-8xl mb-6">üèì</div>
            <h1 class="text-3xl font-bold text-gray-800 mb-4">Table Tennis</h1>
            <p class="text-gray-600 mb-8">Best of 5 Sets Match</p>
            <button onclick="startMatch()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-2xl text-xl transition-colors duration-200 w-full">
                Start Match
            </button>
        </div>
    </div>

    <!-- Match Screen -->
    <div id="matchScreen" class="hidden">




        <!-- Score Display -->
        <div class="bg-white rounded-3xl p-8 mb-8 shadow-2xl">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800">Current Set</h2>
                <div class="text-lg text-gray-600" id="setNumber">Set 1</div>
            </div>
            <div class="flex justify-between items-center">
                <!-- Player 2 (Left) -->
                <div class="text-center flex-1">
                    <div class="relative">
                        <div class="text-9xl font-bold text-blue-600 mb-4 score-text" id="player2Score">0</div>
                        <div class="absolute -top-3 -right-3 bg-red-500 text-white px-6 py-3 rounded-full text-lg font-bold shadow-lg">
                            <span id="player2Sets">0</span>
                        </div>
                    </div>
                    <button onclick="selectServingPlayerByPosition('left')" class="text-2xl font-semibold mb-4 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors" id="player2Name">Player 2</button>
                    <button onclick="decreaseScore(2)" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg text-sm">
                        -1
                    </button>
                </div>
                
                <!-- Separator -->
                <div class="text-6xl text-gray-400 mx-8">:</div>
                
                <!-- Player 1 (Right) -->
                <div class="text-center flex-1">
                    <div class="relative">
                        <div class="text-9xl font-bold text-blue-600 mb-4 score-text" id="player1Score">0</div>
                        <div class="absolute -top-3 -left-3 bg-red-500 text-white px-6 py-3 rounded-full text-lg font-bold shadow-lg">
                            <span id="player1Sets">0</span>
                        </div>
                    </div>
                    <button onclick="selectServingPlayerByPosition('right')" class="text-2xl font-semibold mb-4 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors" id="player1Name">Player 1</button>
                    <button onclick="decreaseScore(1)" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg text-sm">
                        -1
                    </button>
                </div>
            </div>
        </div>

        <!-- New Match Button -->
        <div class="text-center mb-8">
            <button onclick="newMatch()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl text-lg">
                New Match
            </button>
        </div>


    </div>



    <!-- Match End Screen -->
    <div id="matchEndScreen" class="hidden flex items-center justify-center min-h-screen">
        <div class="bg-white rounded-3xl shadow-2xl p-12 text-center max-w-md w-full">
            <div class="text-8xl mb-6">üèÜ</div>
            <h1 class="text-3xl font-bold text-gray-800 mb-4" id="winnerText">Match Complete!</h1>
            <div class="text-xl text-gray-600 mb-8" id="finalScore"></div>
            <button onclick="newMatch()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-2xl text-xl transition-colors duration-200 w-full">
                New Match
            </button>
        </div>
    </div>

    <script>
        let gameState = {
            player1Score: 0,
            player2Score: 0,
            player1Sets: 0,
            player2Sets: 0,
            currentSet: 1,
            matchActive: false,
            lastScrollTime: 0,
            servingPlayer: 1,
            servingCount: 0,
            initialServingPlayer: 1,
            player1OnLeft: false // Player 1 starts on right, Player 2 on left
        };
        
        let currentUtterance = null;

        function startMatch() {
            document.getElementById('preMatch').classList.add('hidden');
            document.getElementById('matchScreen').classList.remove('hidden');
            gameState.matchActive = true;
            updateDisplay();
            announceScore("Match started! Good luck players!");
        }

        function newMatch() {
            // Stop any current announcement
            if (currentUtterance) {
                speechSynthesis.cancel();
                currentUtterance = null;
            }
            
            gameState = {
                player1Score: 0,
                player2Score: 0,
                player1Sets: 0,
                player2Sets: 0,
                currentSet: 1,
                matchActive: false,
                lastScrollTime: 0,
                servingPlayer: 1,
                servingCount: 0,
                initialServingPlayer: 1,
                player1OnLeft: false
            };
            
            document.getElementById('preMatch').classList.remove('hidden');
            document.getElementById('matchScreen').classList.add('hidden');
            document.getElementById('matchEndScreen').classList.add('hidden');
        }

        function selectServingPlayer(player) {
            if (gameState.player1Score === 0 && gameState.player2Score === 0 && gameState.currentSet === 1) {
                gameState.servingPlayer = player;
                gameState.initialServingPlayer = player;
                updateDisplay();
            }
        }

        function selectServingPlayerByPosition(position) {
            if (gameState.player1Score === 0 && gameState.player2Score === 0 && gameState.currentSet === 1) {
                // Determine which player is at the clicked position
                let selectedPlayer;
                if (position === 'left') {
                    selectedPlayer = gameState.player1OnLeft ? 1 : 2;
                } else { // position === 'right'
                    selectedPlayer = gameState.player1OnLeft ? 2 : 1;
                }
                
                gameState.servingPlayer = selectedPlayer;
                gameState.initialServingPlayer = selectedPlayer;
                updateDisplay();
            }
        }

        function updateDisplay() {
            // Determine which player is on which side
            const leftPlayer = gameState.player1OnLeft ? 1 : 2;
            const rightPlayer = gameState.player1OnLeft ? 2 : 1;
            
            // Update scores based on current sides
            if (gameState.player1OnLeft) {
                document.getElementById('player2Score').textContent = gameState.player1Score;
                document.getElementById('player1Score').textContent = gameState.player2Score;
                document.getElementById('player2Sets').textContent = gameState.player1Sets;
                document.getElementById('player1Sets').textContent = gameState.player2Sets;
                document.getElementById('player2Name').textContent = 'Player 1';
                document.getElementById('player1Name').textContent = 'Player 2';
            } else {
                document.getElementById('player1Score').textContent = gameState.player1Score;
                document.getElementById('player2Score').textContent = gameState.player2Score;
                document.getElementById('player1Sets').textContent = gameState.player1Sets;
                document.getElementById('player2Sets').textContent = gameState.player2Sets;
                document.getElementById('player1Name').textContent = 'Player 1';
                document.getElementById('player2Name').textContent = 'Player 2';
            }
            
            document.getElementById('setNumber').textContent = `Set ${gameState.currentSet}`;
            
            // Update serving indicator by changing player name color and adding flash animation
            const player1Name = document.getElementById('player1Name');
            const player2Name = document.getElementById('player2Name');
            
            // Determine which side the serving player is on
            const servingPlayerOnLeft = (gameState.servingPlayer === 1 && gameState.player1OnLeft) || 
                                       (gameState.servingPlayer === 2 && !gameState.player1OnLeft);
            
            if (servingPlayerOnLeft) {
                player2Name.className = 'text-2xl font-semibold mb-4 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors text-yellow-500 animate-pulse';
                player1Name.className = 'text-2xl font-semibold mb-4 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors text-gray-700';
            } else {
                player1Name.className = 'text-2xl font-semibold mb-4 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors text-yellow-500 animate-pulse';
                player2Name.className = 'text-2xl font-semibold mb-4 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors text-gray-700';
            }
        }
        
        function updateServing() {
            gameState.servingCount++;
            // Change serve every 2 points (except in deuce situations)
            const totalPoints = gameState.player1Score + gameState.player2Score;
            if (totalPoints >= 20) {
                // In deuce (20+ points), serve changes every point
                if (gameState.servingCount >= 1) {
                    gameState.servingPlayer = gameState.servingPlayer === 1 ? 2 : 1;
                    gameState.servingCount = 0;
                }
            } else {
                // Normal serving: every 2 points
                if (gameState.servingCount >= 2) {
                    gameState.servingPlayer = gameState.servingPlayer === 1 ? 2 : 1;
                    gameState.servingCount = 0;
                }
            }
        }

        function increaseScore(player) {
            if (!gameState.matchActive) return;
            
            // Prevent multiple increases within 1 second
            if (Date.now() - gameState.lastScrollTime < 1000) {
                return;
            }
            gameState.lastScrollTime = Date.now();

            if (player === 1) {
                gameState.player1Score++;
            } else {
                gameState.player2Score++;
            }

            updateServing();
            updateDisplay();
            checkSetWin();
            announceCurrentScore();
        }

        function decreaseScore(player) {
            if (!gameState.matchActive) return;
            
            if (player === 1 && gameState.player1Score > 0) {
                gameState.player1Score--;
            } else if (player === 2 && gameState.player2Score > 0) {
                gameState.player2Score--;
            }
            
            updateDisplay();
            announceCurrentScore();
        }

        function checkSetWin() {
            const p1Score = gameState.player1Score;
            const p2Score = gameState.player2Score;
            
            // Check if someone won the set (11 points, must win by 2)
            if ((p1Score >= 11 && p1Score - p2Score >= 2) || (p2Score >= 11 && p2Score - p1Score >= 2)) {
                let winner, isShutout = false;
                let announcementText = '';
                
                if (p1Score > p2Score) {
                    gameState.player1Sets++;
                    winner = 'Player 1';
                    // Check for shutout (11-0)
                    if (p1Score === 11 && p2Score === 0) {
                        isShutout = true;
                        announcementText = `Player 1 wins set ${gameState.currentSet}! ◊ë◊®◊ï◊ö ◊î◊ë◊ê ◊ú◊û◊ï◊¢◊ì◊ï◊ü ◊î◊ê◊§◊°◊ô◊ù!`;
                    } else {
                        announcementText = `Player 1 wins set ${gameState.currentSet}!`;
                    }
                } else {
                    gameState.player2Sets++;
                    winner = 'Player 2';
                    // Check for shutout (11-0)
                    if (p2Score === 11 && p1Score === 0) {
                        isShutout = true;
                        announcementText = `Player 2 wins set ${gameState.currentSet}! ◊ë◊®◊ï◊ö ◊î◊ë◊ê ◊ú◊û◊ï◊¢◊ì◊ï◊ü ◊î◊ê◊§◊°◊ô◊ù!`;
                    } else {
                        announcementText = `Player 2 wins set ${gameState.currentSet}!`;
                    }
                }
                
                // Only announce for shutouts
                if (isShutout) {
                    announceScoreWithoutCancel(`◊ë◊®◊ï◊ö ◊î◊ë◊ê ◊ú◊û◊ï◊¢◊ì◊ï◊ü ◊î◊ê◊§◊°◊ô◊ù!`);
                }
                
                // Disable match activity during the 5-second pause
                gameState.matchActive = false;
                
                // Check if match is won (best of 5 = first to 3 sets)
                if (gameState.player1Sets === 3 || gameState.player2Sets === 3) {
                    // End match after 5 seconds
                    setTimeout(() => {
                        endMatch();
                    }, 5000);
                } else {
                    // Start new set after 5 seconds
                    setTimeout(() => {
                        startNextSet();
                    }, 5000);
                }
            }
        }

        function startNextSet() {
            // Start new set
            gameState.currentSet++;
            gameState.player1Score = 0;
            gameState.player2Score = 0;
            gameState.servingCount = 0;
            
            // Switch sides after each set
            gameState.player1OnLeft = !gameState.player1OnLeft;
            
            // The initial serving player always serves from the same side
            // So we need to determine who should serve based on the side switching
            if (gameState.currentSet % 2 === 1) {
                // Odd sets: initial serving player serves
                gameState.servingPlayer = gameState.initialServingPlayer;
            } else {
                // Even sets: other player serves
                gameState.servingPlayer = gameState.initialServingPlayer === 1 ? 2 : 1;
            }
            
            // Re-enable match activity
            gameState.matchActive = true;
            
            updateDisplay();
            announceScore(`Starting set ${gameState.currentSet}`);
        }

        function endMatch() {
            gameState.matchActive = false;
            const winner = gameState.player1Sets === 3 ? "Player 1" : "Player 2";
            
            document.getElementById('matchScreen').classList.add('hidden');
            document.getElementById('matchEndScreen').classList.remove('hidden');
            document.getElementById('winnerText').textContent = `${winner} Wins!`;
            document.getElementById('finalScore').textContent = `Final Score: ${gameState.player1Sets} - ${gameState.player2Sets}`;
            
            announceScore(`Match over! ${winner} wins the match ${gameState.player1Sets} sets to ${gameState.player2Sets}!`);
        }

        function announceCurrentScore() {
            // Stop any current announcement
            if (currentUtterance) {
                speechSynthesis.cancel();
                currentUtterance = null;
            }
            
            // Announce serving player's score first, then opponent's score in Hebrew
            let scoreText;
            if (gameState.servingPlayer === 1) {
                scoreText = `${convertToHebrewNumber(gameState.player1Score)}, ${convertToHebrewNumber(gameState.player2Score)}`;
            } else {
                scoreText = `${convertToHebrewNumber(gameState.player2Score)}, ${convertToHebrewNumber(gameState.player1Score)}`;
            }
            announceScore(scoreText);
        }
        
        function convertToHebrewNumber(num) {
            const hebrewNumbers = {
                0: '◊ê◊§◊°', 1: '◊ê◊ó◊ì', 2: '◊©◊™◊ô◊ô◊ù', 3: '◊©◊ú◊ï◊©', 4: '◊ê◊®◊ë◊¢', 5: '◊ó◊û◊©',
                6: '◊©◊©', 7: '◊©◊ë◊¢', 8: '◊©◊û◊ï◊†◊î', 9: '◊™◊©◊¢', 10: '◊¢◊©◊®',
                11: '◊ê◊ó◊ì ◊¢◊©◊®', 12: '◊©◊™◊ô◊ù ◊¢◊©◊®◊î', 13: '◊©◊ú◊ï◊© ◊¢◊©◊®◊î', 14: '◊ê◊®◊ë◊¢ ◊¢◊©◊®◊î', 15: '◊ó◊û◊© ◊¢◊©◊®◊î',
                16: '◊©◊© ◊¢◊©◊®◊î', 17: '◊©◊ë◊¢ ◊¢◊©◊®◊î', 18: '◊©◊û◊ï◊†◊î ◊¢◊©◊®◊î', 19: '◊™◊©◊¢ ◊¢◊©◊®◊î', 20: '◊¢◊©◊®◊ô◊ù',
                21: '◊¢◊©◊®◊ô◊ù ◊ï◊ê◊ó◊ì', 22: '◊¢◊©◊®◊ô◊ù ◊ï◊©◊™◊ô◊ô◊ù', 23: '◊¢◊©◊®◊ô◊ù ◊ï◊©◊ú◊ï◊©', 24: '◊¢◊©◊®◊ô◊ù ◊ï◊ê◊®◊ë◊¢', 25: '◊¢◊©◊®◊ô◊ù ◊ï◊ó◊û◊©'
            };
            return hebrewNumbers[num] || num.toString();
        }

        function announceScore(text) {
            if ('speechSynthesis' in window) {
                // Stop any current announcement
                if (currentUtterance) {
                    speechSynthesis.cancel();
                }
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.rate = 0.8;
                currentUtterance.pitch = 1;
                currentUtterance.lang = 'he-IL'; // Set Hebrew language
                
                currentUtterance.onend = function() {
                    currentUtterance = null;
                };
                
                speechSynthesis.speak(currentUtterance);
            }
        }

        function announceScoreWithoutCancel(text) {
            if ('speechSynthesis' in window) {
                // Don't stop current announcement for shutout messages
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.rate = 0.8;
                currentUtterance.pitch = 1;
                currentUtterance.lang = 'he-IL'; // Set Hebrew language
                
                currentUtterance.onend = function() {
                    currentUtterance = null;
                };
                
                speechSynthesis.speak(currentUtterance);
            }
        }

        // Scroll detection for scoring
        document.addEventListener('wheel', function(event) {
            if (!gameState.matchActive) return;
            
            // Check for horizontal scroll first (deltaX), then vertical (deltaY) as fallback
            let scrollDelta = event.deltaX;
            if (Math.abs(event.deltaX) < Math.abs(event.deltaY)) {
                scrollDelta = event.deltaY;
            }
            
            // Determine which player is on the right side
            const rightSidePlayer = gameState.player1OnLeft ? 2 : 1;
            const leftSidePlayer = gameState.player1OnLeft ? 1 : 2;
            
            if (scrollDelta > 0) {
                // Scrolled right - give point to player on right side
                increaseScore(rightSidePlayer);
            } else {
                // Scrolled left - give point to player on left side
                increaseScore(leftSidePlayer);
            }
        });

        // Touch scroll detection for mobile
        let touchStartX = 0;
        
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length === 1) {
                touchStartX = event.touches[0].clientX;
            }
        });
        
        document.addEventListener('touchmove', function(event) {
            if (!gameState.matchActive) return;
            
            if (event.touches.length === 1) {
                const currentX = event.touches[0].clientX;
                const touchDelta = currentX - touchStartX;
                
                if (Math.abs(touchDelta) > 50) {
                    // Determine which player is on the right side
                    const rightSidePlayer = gameState.player1OnLeft ? 2 : 1;
                    const leftSidePlayer = gameState.player1OnLeft ? 1 : 2;
                    
                    if (touchDelta > 0) {
                        // Swiped right - give point to player on right side
                        increaseScore(rightSidePlayer);
                    } else {
                        // Swiped left - give point to player on left side
                        increaseScore(leftSidePlayer);
                    }
                    touchStartX = currentX;
                }
            }
        });

        // Keyboard support for bluetooth devices
        document.addEventListener('keydown', function(event) {
            if (!gameState.matchActive) return;
            
            // Prevent too frequent key presses
            if (Date.now() - gameState.lastScrollTime < 1000) {
                return;
            }
            
            // Determine which player is on the right side
            const rightSidePlayer = gameState.player1OnLeft ? 2 : 1;
            const leftSidePlayer = gameState.player1OnLeft ? 1 : 2;
            
            switch(event.key) {
                case 'ArrowRight':
                case 'Right':
                case 'd':
                case 'D':
                    // Right arrow or D key - give point to player on right side
                    increaseScore(rightSidePlayer);
                    event.preventDefault();
                    break;
                case 'ArrowLeft':
                case 'Left':
                case 'a':
                case 'A':
                    // Left arrow or A key - give point to player on left side
                    increaseScore(leftSidePlayer);
                    event.preventDefault();
                    break;
            }
        });

        // Visual feedback for interactions
        document.addEventListener('wheel', function() {
            if (gameState.matchActive) {
                document.body.style.backgroundColor = '#10B981';
                setTimeout(() => {
                    document.body.style.backgroundColor = '';
                }, 200);
            }
        });

        document.addEventListener('touchmove', function() {
            if (gameState.matchActive) {
                document.body.style.backgroundColor = '#10B981';
                setTimeout(() => {
                    document.body.style.backgroundColor = '';
                }, 200);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c4fa5187d9c231',t:'MTc1NDcxODY0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
